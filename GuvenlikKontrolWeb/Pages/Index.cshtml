@page
@model IndexModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <title>Tur Analiz</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- DataTables CSS -->
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet" />
</head>
<body class="container mt-4">

    <h2>Tur Analiz</h2>

    <div class="row mb-3">
        <div class="col-md-3">
            <label class="form-label">Başlangıç:</label>
            <input type="date" id="baslangic" class="form-control" />
        </div>
        <div class="col-md-3">
            <label class="form-label">Bitiş:</label>
            <input type="date" id="bitis" class="form-control" />
        </div>
        <div class="col-md-3 align-self-end">
            <button onclick="getTurAnaliz()" class="btn btn-primary">Getir</button>
        </div>
    </div>

    <table id="turAnalizTable" class="table table-striped table-bordered">
        <thead id="tableHead"></thead>
        <tbody id="tableBody"></tbody>
    </table>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

    <script>
        let dataTable;

        async function getTurAnaliz() {
            const baslangic = document.getElementById('baslangic').value;
            const bitis = document.getElementById('bitis').value;

            if(!baslangic || !bitis) {
                alert('Lütfen başlangıç ve bitiş tarihlerini girin!');
                return;
            }

            const response = await fetch(`/api/TurAnaliz?baslangic=${baslangic}&bitis=${bitis}`);
            const data = await response.json();

            const tableHead = document.getElementById('tableHead');
            const tableBody = document.getElementById('tableBody');

            tableHead.innerHTML = '';
            tableBody.innerHTML = '';

            if(data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="10" class="text-center">Veri bulunamadı.</td></tr>';
                if (dataTable) dataTable.destroy();
                return;
            }

            // Başlıkları oluştur
            const headers = Object.keys(data[0]);
            let headRow = '<tr>';
            headers.forEach(h => headRow += `<th>${h}</th>`);
            headRow += '</tr>';
            tableHead.innerHTML = headRow;

            // Satırları oluştur
            data.forEach(row => {
                let tr = '<tr>';
                headers.forEach(h => tr += `<td>${row[h]}</td>`);
                tr += '</tr>';
                tableBody.innerHTML += tr;
            });

            // DataTable uygula / reset
            if (dataTable) dataTable.destroy();
            dataTable = $('#turAnalizTable').DataTable({
                paging: true,
                searching: true,
                info: true,
                lengthMenu: [5, 10, 25, 50]
            });
        }
    </script>

</body>
</html>
